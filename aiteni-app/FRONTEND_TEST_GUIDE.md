# 前端测试指南

## 📋 测试前准备

### 1. 确认后端服务运行

打开命令行，启动后端服务：

```bash
cd g:\MyProjs\AiTeni\aiteni-backend
python manage.py runserver
```

确认看到类似输出：
```
Django version 4.2.x, using settings 'backend.settings'
Starting development server at http://127.0.0.1:8000/
```

### 2. 微信开发者工具配置

1. 打开微信开发者工具
2. 导入项目：`g:\MyProjs\AiTeni\aiteni-app`
3. 进入"详情" → "本地设置"
4. ✅ **必须勾选**："不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"

### 3. 检查文件状态

确认以下文件已更新：

- ✅ `miniprogram/utils/api.js` - BASE_URL 为 `http://localhost:8000/api`
- ✅ `miniprogram/pages/questionnaire/questionnaire.js` - 使用两阶段评估版本
- ✅ `miniprogram/pages/welcome/welcome.js` - 包含断点续答逻辑
- ✅ `backend/urls.py` - 包含 `/api/evaluation/basic` 和 `/api/evaluation/full`
- ✅ `backend/evaluation_views.py` - 实现了 `evaluate_basic()` 和 `evaluate_full()`

---

## 🧪 测试场景

### 场景 1: 完整流程测试（基础题 → 进阶题）

**前提条件**：用户回答基础题后，评估等级 ≥ 3.0

**步骤**：

1. 启动小程序，点击"开始评测"
2. 回答所有基础题（约 6-8 题）
3. 点击"提交"
4. 观察结果：
   - 应该弹出提示："您的初步水平约为 NTRP X.X。为了获得更准确的评估结果，建议继续完成进阶题目。"
   - 点击"继续"
5. 回答进阶题（约 4-6 题）
6. 点击"提交"
7. 进入结果页，查看完整评估结果

**预期结果**：
- ✅ 页面跳转流畅
- ✅ 题目显示正常
- ✅ 答案选择和保存正常
- ✅ 阶段切换提示清晰
- ✅ 最终结果显示详细（等级、优势、短板、维度详情）

---

### 场景 2: 仅基础题流程（等级 < 3.0）

**前提条件**：用户回答基础题后，评估等级 < 3.0

**步骤**：

1. 启动小程序，点击"开始评测"
2. 回答基础题（尽量选择较低分值的选项）
3. 点击"提交"
4. 观察结果：
   - 应该直接跳转到结果页（不提示进阶题）
5. 查看评估结果

**预期结果**：
- ✅ 直接进入结果页
- ✅ 显示评估等级（应该 < 3.0）
- ✅ 可以查看基础评估信息

**提示**：如果需要触发此场景，可以在 `aiteni-core/config/evaluation_config.json` 中调整 `advanced_threshold` 的值。

---

### 场景 3: 断点续答测试

**步骤**：

1. 启动小程序，点击"开始评测"
2. 回答 2-3 题后，**点击左上角返回**
3. 在弹出的确认框中，选择"确认"（保存进度）
4. 返回欢迎页
5. 再次点击"开始评测"
6. 观察结果：
   - 应该弹出提示："检测到未完成的评测，是否继续？"
   - 点击"继续"
7. 应该恢复到之前的答题进度

**预期结果**：
- ✅ 进度正确保存
- ✅ 已回答的题目显示正确的选中状态
- ✅ 进度条显示正确的百分比
- ✅ 可以继续回答剩余题目

---

### 场景 4: 重新开始测试

**步骤**：

1. 启动小程序，点击"开始评测"
2. 回答 2-3 题后，点击左上角返回
3. 返回欢迎页
4. 再次点击"开始评测"
5. 在弹出的提示框中，点击"重新开始"
6. 观察结果：
   - 应该清除之前的进度
   - 从第一题开始

**预期结果**：
- ✅ 进度被清除
- ✅ 所有题目恢复未选中状态
- ✅ 进度条归零

---

### 场景 5: 历史记录查看

**步骤**：

1. 完成一次完整评测
2. 切换到"历史"标签页
3. 查看评测记录列表
4. 点击某条记录，查看详细结果

**预期结果**：
- ✅ 历史记录正确显示
- ✅ 显示评测时间和等级
- ✅ 可以查看详细结果

---

## 🔍 调试技巧

### 查看网络请求

1. 打开微信开发者工具
2. 点击"调试器"标签
3. 选择"Network"面板
4. 筛选 XHR 请求

**关键接口检查**：

- `GET /api/evaluation/questions` - 获取题目配置
  - 状态码应该为 200
  - Response 应包含 `basic_questions` 和 `advanced_questions`

- `POST /api/evaluation/basic` - 基础评估
  - Request Body: `{"answers": {"Q1": "Q1_A1", ...}}`
  - Response: `{"code": 0, "data": {"level": x.x, "need_advanced": true/false}}`

- `POST /api/evaluation/full` - 完整评估
  - Request Body: `{"answers": {"Q1": "Q1_A1", ...}}`
  - Response: `{"code": 0, "data": {"level": x.x, "advantages": [...], ...}}`

### 查看Console日志

在"调试器" → "Console"面板查看：

- 网络请求错误
- JavaScript 错误
- 自定义 `console.log()` 输出

### 查看Storage

在"调试器" → "Storage"面板查看：

- `questions_config` - 缓存的题目配置
- `current_answers` - 当前答题进度
- `basic_answers` - 基础题答案（第二阶段时）
- `latest_result` - 最新评估结果

---

## ❌ 常见问题

### 问题 1: 点击"开始评测"没有反应

**可能原因**：
- 后端服务未启动
- API 地址配置错误
- 微信开发者工具未开启"不校验合法域名"

**解决方法**：
1. 确认后端服务运行：`curl http://localhost:8000/api/health`
2. 检查 `utils/api.js` 中的 `BASE_URL`
3. 检查微信开发者工具设置

### 问题 2: 题目显示为空

**可能原因**：
- 题目配置文件不存在或格式错误
- 接口返回数据格式不正确

**解决方法**：
1. 检查 `aiteni-backend/config/questions.json` 是否存在
2. 测试接口：`curl http://localhost:8000/api/evaluation/questions`
3. 检查返回的 JSON 格式是否正确

### 问题 3: 提交后报错 "评估失败"

**可能原因**：
- 答案格式不正确
- 后端评估逻辑出错

**解决方法**：
1. 查看微信开发者工具 Console 的错误信息
2. 查看后端日志（如果配置了）
3. 检查 Network 面板的 Response

### 问题 4: 没有触发进阶题提示

**可能原因**：
- 基础评估等级 < 3.0（不满足进阶条件）
- 后端返回的 `need_advanced` 字段不正确

**解决方法**：
1. 尝试回答较高分值的选项
2. 检查后端 `/api/evaluation/basic` 接口返回的数据
3. 查看 `aiteni-core/config/evaluation_config.json` 中的 `advanced_threshold`

---

## 📊 测试数据准备

### 模拟高水平用户（触发进阶题）

在基础题中选择：
- 底线能力：选择"能够持续回球，较少失误"
- 技术水平：选择较高级别的选项
- 实战经验：选择"经常参加比赛"

### 模拟低水平用户（不触发进阶题）

在基础题中选择：
- 底线能力：选择"刚开始学习"
- 技术水平：选择基础级别的选项
- 实战经验：选择"很少或从未比赛"

---

## ✅ 测试检查清单

### 基础功能
- [ ] 小程序正常启动
- [ ] 欢迎页正常显示
- [ ] 点击"开始评测"跳转到问卷页
- [ ] 题目正常显示
- [ ] 可以选择答案
- [ ] 进度条正常更新
- [ ] 上一题/下一题按钮正常工作

### 两阶段评估
- [ ] 基础题提交后，等级 ≥ 3.0 时弹出进阶提示
- [ ] 可以选择继续或查看结果
- [ ] 选择"继续"后正确加载进阶题
- [ ] 进阶题提交后跳转到结果页
- [ ] 基础题 + 进阶题答案正确合并

### 断点续答
- [ ] 答题中途退出后，进度被保存
- [ ] 返回欢迎页后，提示继续上次评测
- [ ] 选择"继续"后正确恢复进度
- [ ] 选择"重新开始"后清除进度

### 结果展示
- [ ] 结果页正常显示
- [ ] NTRP 等级正确显示
- [ ] 优势和短板正确显示
- [ ] 维度详情可以展开/折叠
- [ ] 可以返回首页

### 历史记录
- [ ] 历史记录列表正常显示
- [ ] 可以查看历史评测详情
- [ ] 可以删除历史记录

### 错误处理
- [ ] 网络错误时有友好提示
- [ ] 可以重试失败的请求
- [ ] 超时有合理的提示

---

## 🎯 性能检查

- [ ] 题目加载速度 < 2秒
- [ ] 页面切换流畅（无卡顿）
- [ ] 首次加载后，题目配置被缓存
- [ ] 答题进度实时保存（无延迟）

---

## 📝 测试记录

建议在测试过程中记录：

1. **测试时间**：
2. **测试人员**：
3. **测试环境**：
   - 微信开发者工具版本：
   - 后端服务版本：
4. **测试结果**：
   - 通过场景：
   - 失败场景：
   - 发现的问题：
5. **备注**：

---

测试愉快！🎾
