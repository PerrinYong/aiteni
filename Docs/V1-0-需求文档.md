下面这份就是你要的 **V1 版需求文档**，偏工程视角，落地开发用。
按你的要求：**JSON 只存问题本身**，meta/levels/score/dimensions 都在代码里实现。

---

# NTRP 网球等级评估系统 – V1 需求文档

## 0. 目标与范围

通过小程序问卷，让用户回答一系列与真实网球场景强相关的问题，
系统基于 **模糊评分 + 硬性上限**，估算用户的 **NTRP 等级**，并输出：

* 总等级：如 `NTRP 3.5`
* 各维度倾向（如：正手 3.7、发球 3.1 等）
* 自动生成的评语：

  * 总体概述（总等级 + 风格）
  * 优势总结（2–3 个维度）
  * 提升重点（2–3 个维度）
  * 详细拆解（每个维度一小段）

---

## 1. 题目多维度覆盖设计

### 1.1 维度列表（写在代码中）

维度只在代码中定义，用 key 标识：

| 维度 key         | 名称        | 说明                      |
| -------------- | --------- | ----------------------- |
| `baseline`     | 底线综合      | 底线多拍稳定性 + 深度（Q1, Q2）    |
| `forehand`     | 正手        | 正手底线进攻与稳定性（Q3）          |
| `backhand`     | 反手        | 反手底线稳定性与进攻潜力（Q4）        |
| `serve`        | 发球        | 一发/二发稳定性与攻击性（Q5, Q6）    |
| `return`       | 接发球       | 接发稳定性和主动性（Q7）           |
| `net`          | 网前与高压     | 主动上网、截击、高压（Q8）          |
| `footwork`     | 步伐与覆盖     | 场地覆盖能力、被调动时表现（Q9）       |
| `tactics`      | 战术与心理     | 战术理解与临场心理（Q10）          |
| `match_result` | 实战成绩      | 与“俱乐部高手约 4.0”对抗的结果（Q11） |
| `training`     | 训练背景 / 频率 | 训练频率 + 是否有专业背景（Q12）     |

> **注意**：
> 维度定义、中文名称、权重都在代码常量中管理，不在 JSON。

### 1.2 问题与维度映射（固定）

* Q1, Q2 → `baseline`
* Q3 → `forehand`
* Q4 → `backhand`
* Q5, Q6 → `serve`
* Q7 → `return`
* Q8 → `net`
* Q9 → `footwork`
* Q10 → `tactics`
* Q11 → `match_result`
* Q12 → `training`

---

## 2. JSON 配置结构（只包含问题）

> JSON 文件仅负责描述 **问题 + 选项**，不包含 meta/levels/score/dimensions。

### 2.1 JSON 顶层结构示例

```jsonc
{
  "questions": [
    {
      "id": "Q1",
      "text": "你和水平相近的球友，从底线相互对拉时（中速，不是全力爆抽），通常能稳定打多少拍？",
      "options": [
        {
          "id": "Q1_A1",
          "text": "很难连续超过 3 拍，经常 1～2 拍就下网或出界",
          "center_level": 2.0,
          "hard_cap": 2.5
        },
        {
          "id": "Q1_A2",
          "text": "偶尔能打到 4～6 拍，但失误仍然很多",
          "center_level": 2.5,
          "hard_cap": 3.0
        }
        // ...
      ]
    }
    // ...
  ]
}
```

字段说明：

* `id`: 题目唯一 ID（Q1 ~ Q12）
* `text`: 题干文字
* `options[]`:

  * `id`: 选项唯一 ID（如 `Q1_A1`）
  * `text`: 选项文字
  * `center_level`: 该选项代表的“中心 NTRP 等级”（float）
  * `hard_cap`（可选）: 选择该选项后，对总等级增加一个“硬性上限”

### 2.2 12 题简要设计（V1）

（这里不把每个选项全部展开，只定义题目方向，实际选项在 JSON 中维护）

1. **Q1 – 底线对拉拍数**

   * 中速对拉，能稳定多少拍
   * 低选项带 `hard_cap`（如“连续 4 拍都困难” → cap 2.5）

2. **Q2 – 底线击球深度和质量**

   * 是否能稳定压到中后场，是否经常打短
   * 无硬 cap，但 `center_level` 主要在 2.0–4.0

3. **Q3 – 正手整体能力**

   * 从“能把球打回去”到“正手是主要武器”
   * `center_level` 2.0–4.5

4. **Q4 – 反手整体能力**

   * 是否绕正手；是否能对拉；是否有上旋/切削
   * 如果“基本不敢用反手” → `hard_cap` ≈ 3.0

5. **Q5 – 发球稳定性**

   * 是否频繁双误；一发/二发稳定性
   * 经常双误 → `hard_cap` ≈ 3.0

6. **Q6 – 发球威胁性**

   * 发球是否能主动找落点、直接得分或制造压力
   * 无硬 cap，`center_level` 用于拉高 3.0+ 的选手

7. **Q7 – 接发球能力**

   * 面对不同速度发球的状态（慌乱/挡回去/有主动性）
   * 仅 `center_level`，不设硬 cap

8. **Q8 – 网前与高压**

   * 是否敢上网；截击、高压的稳定性
   * `center_level` 2.0–4.5，用于区分底线狗 vs 全能型

9. **Q9 – 步伐与场地覆盖**

   * 被调动、短球/高吊时能否跟上
   * 只用 `center_level`，用于判断体能和移动

10. **Q10 – 战术与心理**

    * 是否只“把球打回去”；是否会针对对手弱点；关键分执行力
    * `center_level` 2.0–4.5

11. **Q11 – 实战成绩**

    * 与“俱乐部高手（约4.0）”打 6 局盘的典型比分
    * 低分选项需有 `hard_cap`（如基本 0:6/1:6 → cap ≈ 3.0）

12. **Q12 – 训练背景 / 频率**

    * 每周打球次数；是否有校队/专业队背景
    * `center_level` 可拉高到 5.0/6.0，但权重较低（辅助校准）

---

## 3. 评分模型设计

### 3.1 等级编码（代码常量）

```ts
const LEVELS = [1.0, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 4.5, 5.0, 5.5, 6.0, 7.0];
// V1 建议主要在 2.0 ~ 5.0 范围活动
```

### 3.2 模糊评分（核心机制）

对每个选项，不是简单“center_level 平均”，而是形成对各等级的**支持度 support[L]**：

* 模糊函数（代码中写死）：

```ts
function membership(level: number, center: number, spread = 1.0): number {
  const diff = Math.abs(level - center);
  if (diff >= spread) return 0;
  return 1 - diff / spread; // 三角形隶属度
}
```

* 对单个答题项的贡献：

```ts
support[L] += membership(L, center_level, spread) * question_weight;
```

* 所有题目遍历完后得到：`support[L]`（L ∈ LEVELS）

### 3.3 最终等级计算

1. **支持度期望值（连续等级）**

```ts
const totalSupport = sum_L(support[L]);
const expectation = totalSupport > 0
  ? sum_L(L * support[L]) / totalSupport
  : fallbackValue; // 一般用 2.0 或直接中位数
```

2. **硬性上限（Hard Cap）**

* 初始化：`hardCap = max(LEVELS)`（例如 7.0）
* 每个被选中的选项，如果配置了 `hard_cap`：

```ts
hardCap = Math.min(hardCap, option.hard_cap);
```

3. **最终等级 & 展示等级**

```ts
const rawLevel = Math.min(expectation, hardCap);   // 应用硬 cap
const roundedLevel = roundToNearest(rawLevel, 0.5); // 展示时四舍五入到 0.5
```

---

## 4. 各维度得分计算

### 4.1 计算方式（简单版）

对每个维度，取该维度关联题目的 `center_level` 加权平均：

```ts
// 仅作 V1 简化，可以后续也改成模糊评分
dimensionScore[dim] = sum(center_level * weight) / sum(weight);
```

* `dim` 由代码里的 `questionDimensionMap[Qx]` 决定（而不是 JSON）。
* 维度分数是用于：

  * 维度评语选择（落在哪个分段）
  * 优势 / 短板排序

---

## 5. 输出设计

### 5.1 输出数据结构（给前端 / UI）

```ts
interface DimensionScores {
  [dimKey: string]: number; // 如 forehand: 3.7
}

interface DimensionComments {
  [dimKey: string]: string; // 一段中文评语
}

interface EvaluateResult {
  totalLevel: number;           // rawLevel，未四舍五入
  roundedLevel: number;         // 展示用，如 3.5
  levelLabel: string;           // 如 “发展中业余选手”
  dimensionScores: DimensionScores;
  dimensionComments: DimensionComments;
  advantages: string[];         // 2–3 个优势维度 key
  weaknesses: string[];         // 2–3 个短板维度 key
  summaryText: string;          // 最终组合好的长文案
}
```

### 5.2 等级标签（levelLabel）

代码里简单映射：

```ts
function mapLevelToLabel(L: number): string {
  if (L <= 1.5) return "初学者";
  if (L <= 2.5) return "入门级爱好者";
  if (L <= 3.5) return "发展中业余选手";
  if (L <= 4.5) return "城市级业余高手";
  if (L <= 5.5) return "准专业 / 专业水平";
  return "职业 / 国际级水平";
}
```

---

## 6. 评语设计（模板规则）

### 6.1 目标

根据：

* `roundedLevel`（总等级）
* `dimensionScores`（各维度分数）
* `dimensionComments`（每维度一句详细说明）

自动生成四部分：

1. 总体概述（总等级 + 风格）
2. 优势总结（2–3 个维度）
3. 提升重点（2–3 个维度）
4. 详细拆解（每个维度一小段）

### 6.2 维度基础评语（在代码中配置）

在代码里写一个配置（类似之前的 `suggestion_rules`），按 **维度 + 分数区间** 给基础句子，例如：

```ts
const dimensionSuggestionRules = {
  forehand: [
    {
      max: 2.5,
      text: "正手稳定性和动作基础偏弱，建议多做稳定中速对拉和基础挥拍练习，先把连续 6～8 拍打稳。"
    },
    {
      min: 2.5,
      max: 3.5,
      text: "正手已具备一定稳定性和方向控制，可以在保证成功率的前提下，增加深度和上旋量。"
    },
    {
      min: 3.5,
      text: "正手已经是你的得分手段之一，可以更多通过节奏变化、节省体能和细化线路选择来提升。"
    }
  ],
  // backhand, serve, ...
};
```

根据维度分数 `score_dim` 落入哪个区间，选取基础评语 `baseText`。

### 6.3 优势 / 短板补充句

相对总等级 `roundedLevel` 判断：

* 高于整体（优势）：

  ```text
  你在这一项上明显高于整体水平，可以把它当成比赛中的主要得分手段之一。
  ```

* 低于整体（短板）：

  ```text
  这一项相对是短板，会在比赛中拖慢整体上限，建议作为近期重点练习方向。
  ```

* 接近整体（中性）：

  ```text
  这一项与整体水平大体一致，可以在保持稳定的基础上，循序渐进地提高质量。
  ```

维度评语 = `baseText + extraText`。

### 6.4 维度排序，选优势与短板

按 `dimensionScores` 排序：

* 取最高的 2–3 个维度 → `advantages`
* 取最低的 2–3 个维度 → `weaknesses`

仅做文案描述，不影响评分。

### 6.5 最终 summaryText 模板

综合各部分拼接：

```text
整体来看，你当前的综合水平约为 NTRP {roundedLevel}（{levelLabel}）。

你的主要优势在：
- {优势维度1名称}（约 {score1} 级）：{该维度评语的前 1 句}
- {优势维度2名称}（约 {score2} 级）：{...}
{可选：如果有明显第三项优势，也可以列出来}

当前最值得优先提升的环节是：
- {短板维度1名称}（约 {scoreX} 级）：{该维度评语的前 1 句}
- {短板维度2名称}（约 {scoreY} 级）：{...}
如果你只想抓重点，建议优先在上述 2～3 个方向投入练习时间。

下面是各个维度的具体评估与建议：

【底线综合（约 {baseline_score} 级）】
{baseline_comment}

【正手（约 {forehand_score} 级）】
{forehand_comment}

【反手（约 {backhand_score} 级）】
{backhand_comment}

【发球（约 {serve_score} 级）】
{serve_comment}

【接发球（约 {return_score} 级）】
{return_comment}

【网前与高压（约 {net_score} 级）】
{net_comment}

【步伐与场地覆盖（约 {footwork_score} 级）】
{footwork_comment}

【战术与心理（约 {tactics_score} 级）】
{tactics_comment}

【实战成绩（约 {match_result_score} 级）】
{match_result_comment}

【训练背景与频率（约 {training_score} 级）】
{training_comment}
```

---

## 7. V1 范围说明与后续扩展点

### 7.1 V1 已实现范围

* 问卷：12 题，多维度覆盖 NTRP 核心能力
* 配置：JSON 只保存 `questions` 与选项 `center_level` / `hard_cap`
* 评分：

  * 模糊评分（支持度 + 期望值）
  * 硬性上限（Hard Cap）
  * 等级四舍五入到 0.5
* 输出：

  * 总等级 + 等级标签
  * 各维度分数
  * 按维度生成详细评语
  * 自动组合总评语：概述 + 优势 + 短板 + 详细拆解

### 7.2 后续可扩展

* 根据真实用户数据微调：

  * 每题选项的 `center_level`、`hard_cap`
  * 题目权重（例如实战成绩权重适度拉高/降低）
* 拆分 “底线综合” 为 “正手底线、反手底线” 两个维度
* 加入 “打分自信度” 机制，识别用户是否夸大/贬低自己

---

如果你需要下一步，我可以基于这个需求文档，
直接给一份 **TypeScript 评分核心文件骨架**（`evaluateNtrp.ts`），
把：读取 JSON、模糊打分、硬 cap、维度评分、评语生成，全串起来。
